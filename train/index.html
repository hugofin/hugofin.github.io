<!doctype html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html lang="en-GB">
    <head>
        <title>trainstationcoldle</title>
        <link
            href="https://fonts.cdnfonts.com/css/dot-matrix"
            rel="stylesheet"
        />
        <style>
            :root {
                font-family: monospace;
            }

            body {
                max-width: 25rem;
                margin: 0rem auto;
            }

            marquee {
                font-family: "Dot Matrix";
                font-weight: normal;
                font-size: 25px;
                transform: skewX(-5deg);
                margin: 0px;
            }

            .top {
                background-color: #223;
                height: 4vh;
                color: #9d9;
                padding: 0.8rem;
                align-content: center;
                border-bottom: 1rem solid #ccc;
                margin-bottom: 1rem;
            }

            .midriff {
                height: 65vh;
                overflow: auto;
            }

            .footer {
                background-color: #ef3c24;
                height: 10vh;
                display: flex;
                justify-content: space-between;
                color: #fff;
                display: flex;
                flex-direction: column;
                row-gap: 0.2rem;
                padding: 0.8rem;
            }

            .attempts {
                display: flex;
                flex-direction: column;
                row-gap: 1rem;
                align-items: center;
            }

            .ticket {
                width: 18rem;
                height: 10rem;
                background-color: #ff6816;
                display: flex;
                flex-direction: column;
                padding-top: 2rem;
                border-radius: 10px;
            }

            .middle {
                height: 8rem;
                background-color: #fff8af;
                display: flex;
                flex-direction: row;
                column-gap: 1rem;
                align-items: center;
            }

            .letter {
                width: 2.5rem;
                height: 2.5rem;
                color: #fff;
                text-align: center;
                align-content: center;
            }

            .far {
                background-color: #aaa;
            }

            .close {
                background-color: #faa;
            }

            .exact {
                background-color: #ada;
            }

            .loc {
                position: relative;
                bottom: 1px;
                left: 3px;
                color: #fff;
                text-wrap: nowrap;
            }
        </style>
    </head>
    <body>
        <div class="top">
            <marquee id="today"></marquee>
        </div>

        <div class="midriff">
            <div class="attempts" id="attempts"></div>
        </div>

        <div class="footer">
            <div>
                <input id="input" type="text" />
                <button id="guess" onclick="guess()">guess...</button>
            </div>

            <span id="res"></span>
        </div>

        <script src="./stations.js"></script>
        <script>
            const today = stations[Math.floor(Math.random() * stations.length)];
            document.getElementById("today").innerText =
                `Calling at: ${today.crsCode}`;

            const stationsDict = {};
            const guesses = [];

            for (var s of stations) {
                stationsDict[s.stationName.toLowerCase().replaceAll(" ", "")] =
                    {
                        stationName: s.stationName,
                        lat: s.lat,
                        long: s.long,
                        crsCode: s.crsCode,
                        constituentCountry: s.constituentCountry,
                    };
            }

            function addGuess(station) {
                console.log(station);

                var attempt = document.createElement("div");
                attempt.classList.add("ticket");

                var mid = document.createElement("div");
                mid.classList.add("middle");
                attempt.appendChild(mid);

                for (var l in station.crsCode) {
                    var newCel = document.createElement("div");
                    newCel.innerText = station.crsCode[l];
                    switch (true) {
                        case station.crsCode[l] == today.crsCode[l]:
                            newCel.classList.add("letter", "exact");
                            break;
                        case today.crsCode.includes(station.crsCode[l]):
                            newCel.classList.add("letter", "close");
                            break;
                        default:
                            newCel.classList.add("letter", "far");
                            break;
                    }
                    mid.appendChild(newCel);
                }

                var loc = document.createElement("span");
                loc.classList.add("loc");
                loc.innerText = station.stationName; //stationsDict[code].stationName;
                attempt.appendChild(loc);

                document.getElementById("attempts").appendChild(attempt);
            }

            function guess() {
                const g = document
                    .getElementById("input")
                    .value.toLowerCase()
                    .replaceAll(" ", "");

                var res = document.getElementById("res");

                if (g in stationsDict) {
                    addGuess(stationsDict[g]);

                    if (
                        g == today.stationName.toLowerCase().replaceAll(" ", "")
                    ) {
                        res.innerText = "well done!";
                    } else {
                        res.innerText = `not quite, ${g} is ${stationsDict[g].crsCode}`;
                    }
                } else {
                    res.innerText = `there isnt a station at ${g}`;
                }
            }
        </script>
    </body>
</html>
