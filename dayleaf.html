<!doctype html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<html lang="en-GB">
    <head>
        <title>can you guess what tree this is?</title>
        <style>
            :root {
                font-family: system-ui;
            }
            body {
                max-width: 20rem;
                margin: 2rem auto;
            }
            .life {
                font-family: system-ui;
                font-size: 20px;
                color: #ff4444;
                user-select: none;
            }
        </style>
    </head>
    <body>
        <h1>dayleaf</h1>
        <img src="" id="image" height="300" />
        <div>
            <span id="h1" class="life">♥</span>
            <span id="h2" class="life">♥</span>
            <span id="h3" class="life">♥</span>
            <span id="h4" class="life">♥</span>
            <span id="h5" class="life">♥</span>
        </div>
        <div id="answer"></div>
        <form onsubmit="return false">
            <label>
                <input id="query" autocomplete="off" />
                <input
                    id="submit"
                    type="submit"
                    value="guess..."
                    onclick="realTimeGuess()"
                />
            </label>
        </form>
        <div id="result"></div>
        <ul id="guesses">
            <li id="g5" style="display: none"></li>
            <li id="g4" style="display: none"></li>
            <li id="g3" style="display: none"></li>
            <li id="g2" style="display: none"></li>
            <li id="g1" style="display: none"></li>
        </ul>

        <div id="score"></div>

        <script>
            const trees = [
                ["silver birch", "8/8a/Betula_pendula_Finland.jpg"],
                [
                    "aspen",
                    "/thumb/0/03/Populus_tremula_-_Eurasian_Aspen%2C_Giresun_2016_01-2.jpg/330px-Populus_tremula_-_Eurasian_Aspen%2C_Giresun_2016_01-2.jpg",
                ],
                [
                    "common lime",
                    "thumb/5/58/Tilia_May_2014-1.jpg/960px-Tilia_May_2014-1.jpg",
                ],
                ["hazel", "c/c3/Hazelnut_in_blossom.jpg"],
                ["alder", "2/2c/20120904Alnus_glutinosa01.jpg"],
                [
                    "crab apple",
                    "b/b6/Flowering_crab_apple_tree_%28Malus_sylvestris%29_-_geograph.org.uk_-_1310092.jpg",
                ],
                ["hornbeam", "2/2c/Carpinus_betulus_-_Hunsrück_001.jpg"],
                ["elm", "0/03/Constable_-_Study_of_an_Elm_Tree_-_c1821.jpeg"],
                ["beech", "5/5b/Grib_skov.jpg"],
                ["blackthorn", "2/29/Schlehe1.jpg"],
                [
                    "holly",
                    "thumb/3/37/Ilex_aquifolium_in_the_Tashkent_Botanical_Garden.jpg/500px-Ilex_aquifolium_in_the_Tashkent_Botanical_Garden.jpg",
                ],
                ["common hawthorn", "f/f5/%28ms%29_Crataegus_monogyna_12.jpg"],
                ["oak", "d/d3/Eiche_in_Suffolk.jpg"], //a/af/Quercus_robur.jpg
                ["sycamore", "d/d3/Eiche_in_Suffolk.jpg"],
                ["field maple", "c/c5/Acer_campestre_009.jpg"],
                [
                    "london plane",
                    "b/b9/London_Plane_in_the_evening_rush_hour%2C_Millbank%2C_London_-_geograph.org.uk_-_4816671.jpg",
                ],
                [
                    "wild service tree",
                    "f/f0/Sorbus_torminalis_Trunk_and_canopy.jpg",
                ],
                [
                    "sweet chestnut",
                    "thumb/7/7a/Sweet_chestnuts_in_Farnham.jpg/2560px-Sweet_chestnuts_in_Farnham.jpg",
                ],
                ["goat willow", "1/19/Salix_caprea_sl19.jpg"],
                [
                    "horse chestnut",
                    "thumb/2/2c/Horse_chestnut_flowers_in_Brodalen_4.jpg/960px-Horse_chestnut_flowers_in_Brodalen_4.jpg",
                ],
                [
                    "ash",
                    "6/62/Ash_in_Under_Hooken_-_geograph.org.uk_-_240969.jpg",
                ],
                [
                    "rowan",
                    "thumb/2/26/Rowan_tree_20081002b.jpg/960px-Rowan_tree_20081002b.jpg",
                ],
                ["yew", "7/7e/Taxus_baccata_tree.jpg"],
                ["larch", "8/88/Autumn_Larch_-_geograph.org.uk_-_265498.jpg"],
                ["scots pine", "9/91/Skuleskogen_pine.jpg"],
                ["juniper", "d/d6/JuniperusCommunisAlpina.jpg"],
            ];

            const d = new Date();
            const seed = `${d.getUTCDate()}${d.getUTCFullYear()}${d.getUTCMonth()}`;
            let previousGuesses = [];
            let finishedToday = "no";

            function random() {
                let x = Math.sin(seed) * 10000;
                return x - Math.floor(x);
            }

            const todays = trees[Math.floor(random() * trees.length)];
            document.getElementById("image").src =
                `https://upload.wikimedia.org/wikipedia/commons/${todays[1]}`;

            let wr = 0;
            let wins = localStorage.getItem("wins");
            let games = localStorage.getItem("games");
            const lastSeed = localStorage.getItem("lastSeed");
            if (lastSeed != seed) {
                localStorage.setItem("finishedToday", finishedToday);
                localStorage.setItem("lastSeed", seed);
                localStorage.setItem(
                    "previousGuesses",
                    JSON.stringify(previousGuesses),
                );
            } else {
                finishedToday = localStorage.getItem("finishedToday");
                let x = JSON.parse(localStorage.getItem("previousGuesses"));
                for (var g of x) {
                    guess(g.replace("✕", "").replace("✓", ""));
                }
            }

            function realTimeGuess() {
                let x = document.getElementById("query").value;
                guess(x);
                localStorage.setItem(
                    "previousGuesses",
                    JSON.stringify(previousGuesses),
                );
            }

            function guess(g) {
                let res = "";

                if (g) {
                    if (
                        g.toLowerCase().replace(" ", "") ==
                        todays[0].replaceAll(" ", "")
                    ) {
                        res = `✓ ${g}`;
                        document.getElementById("query").disabled = "disabled";
                        document.getElementById("submit").disabled = "disabled";

                        if (finishedToday != "yes") {
                            wins++;
                            games++;
                            localStorage.setItem("finishedToday", "yes");
                        }

                        localStorage.setItem("wins", wins);
                        localStorage.setItem("games", games);

                        document.getElementById("score").innerText =
                            `Well done! your win rate is ${Math.floor((wins / games) * 100)}%`;
                    } else {
                        res = `✕ ${g}`;
                        document.getElementById(
                            `h${5 - previousGuesses.length}`,
                        ).innerText = "♡";
                        document.getElementById("query").value = "";
                    }

                    previousGuesses.push(res);
                    document.getElementById(
                        `g${previousGuesses.length}`,
                    ).innerText = res;
                    document.getElementById(
                        `g${previousGuesses.length}`,
                    ).style.display = "block";

                    if (previousGuesses.length == 5) {
                        document.getElementById("query").disabled = "disabled";
                        document.getElementById("submit").disabled = "disabled";
                        document.getElementById("answer").innerText = todays[0];

                        if (finishedToday != "yes") {
                            games++;
                            localStorage.setItem("finishedToday", "yes");
                        }

                        if (wins != 0) {
                            wr = (wins / games) * 100;
                        }

                        localStorage.setItem("games", games);

                        document.getElementById("score").innerText =
                            `Better luck next time, your win rate is ${Math.floor(wr)}%`;
                    }
                }
            }
        </script>
    </body>
</html>
