<!doctype html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html lang="en-GB">
    <head>
        <title>can you guess what tree this is?</title>
        <style>
            :root {
                font-family: system-ui;
            }
            body {
                max-width: 20rem;
                margin: 2rem auto;
            }
            .life {
                font-family: system-ui;
                font-size: 20px;
                color: #ff4444;
                user-select: none;
            }
        </style>
    </head>
    <body>
        <h1>dayleaf</h1>
        <img src="" id="image" height="300" />
        <div>
            <span id="h1" class="life">♥</span>
            <span id="h2" class="life">♥</span>
            <span id="h3" class="life">♥</span>
            <span id="h4" class="life">♥</span>
            <span id="h5" class="life">♥</span>
        </div>
        <div id="answer"></div>
        <form onsubmit="return false">
            <label>
                <input id="query" autocomplete="off" />
                <input
                    id="submit"
                    type="submit"
                    value="guess..."
                    onclick="rtg()"
                />
            </label>
        </form>
        <div id="result"></div>
        <ul id="guesses">
            <li id="g5" style="display: none"></li>
            <li id="g4" style="display: none"></li>
            <li id="g3" style="display: none"></li>
            <li id="g2" style="display: none"></li>
            <li id="g1" style="display: none"></li>
        </ul>

        <div id="123"></div>

        <script>
            let trees = [
                [
                    "oak",
                    "https://upload.wikimedia.org/wikipedia/commons/a/af/Quercus_robur.jpg",
                ],
                [
                    "silver birch",
                    "https://upload.wikimedia.org/wikipedia/commons/8/8a/Betula_pendula_Finland.jpg",
                ],
            ];

            const d = new Date();
            var seed = `${d.getUTCDate()}${d.getUTCFullYear()}${d.getUTCMonth()}`;
            let previousGuesses = [];

            function random() {
                var x = Math.sin(seed++) * 10000;
                return x - Math.floor(x);
            }

            let todays = trees[Math.floor(random() * trees.length)];

            document.getElementById("image").src = todays[1];

            var lastSeed = localStorage.getItem("lastSeed");
            if (lastSeed != seed) {
                localStorage.setItem("lastSeed", seed);
                localStorage.setItem(
                    "previousGuesses",
                    JSON.stringify(previousGuesses),
                );
            } else {
                let x = JSON.parse(localStorage.getItem("previousGuesses"));

                console.log(x);

                for (var g of x) {
                    console.log(g);
                    guess(g.replace("❌", "").replace("✓", ""));
                }
            }

            function rtg() {
                let x = document.getElementById("query").value;
                guess(x);
                localStorage.setItem(
                    "previousGuesses",
                    JSON.stringify(previousGuesses),
                );
            }

            function guess(g) {
                let res = "";

                if (g) {
                    if (
                        g.toLowerCase().replace(" ", "") ==
                        todays[0].replaceAll(" ", "")
                    ) {
                        res = `${g}✓`;
                        document.getElementById("query").disabled = "disabled";
                        document.getElementById("submit").disabled = "disabled";
                    } else {
                        res = `${g}❌`;
                        document.getElementById(
                            `h${5 - previousGuesses.length}`,
                        ).innerText = "♡";
                        document.getElementById("query").value = "";
                    }

                    previousGuesses.push(res);
                    document.getElementById(
                        `g${previousGuesses.length}`,
                    ).innerText = res;
                    document.getElementById(
                        `g${previousGuesses.length}`,
                    ).style.display = "block";

                    if (previousGuesses.length == 5) {
                        document.getElementById("query").disabled = "disabled";
                        document.getElementById("submit").disabled = "disabled";
                        document.getElementById("answer").innerText = todays[0];
                    }
                }
            }
        </script>
    </body>
</html>
