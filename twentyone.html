<!doctype html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<html lang="en-GB">
    <head>
        <title>gambling simulator</title>
        <style>
            :root {
                font-family: system-ui;
            }
            body {
                max-width: 22rem;
                margin: 0rem auto;
                padding: 1rem;
                background-color: #393;
            }

            .hand {
                display: flex;
                flex-direction: row;
            }

            .row {
                display: flex;
            }

            .dealt {
                display: flex;
                flex-direction: column;
                position: fixed;
                left: 10rem;
            }

            .footer {
                display: flex;
                flex-direction: row;
                column-gap: 4rem;
                position: fixed;
                bottom: 3rem;
            }

            .options {
                display: flex;
                flex-direction: column;
                row-gap: 1rem;
                width: 7rem;
            }

            card {
                width: 3.8rem;
                height: 5.8rem;
                border: 0.2rem #e0dba8 solid;
                border-radius: 0.5rem;
                padding: 1rem;
                background-color: #fffded;
            }

            button {
                height: 4rem;
                width: 100%;
                padding: 0.1rem;
                background: none;
                font-style: oblique;
                font-weight: bold;
                border: 2px #fafafa dashed;
                color: #fafafa;
            }

            button:active {
                background-color: #6c6;
            }

            button:disabled {
                background-color: #282;
                color: #c7c7c7;
                border-color: #c7c7c7;
            }

            .♥ {
                color: #d00;
            }

            .♠ {
                color: #000;
            }

            .♦ {
                color: #f61;
            }

            .♣ {
                color: #30c;
            }

            .down {
                background-color: #f23036;
                color: rgba(0, 0, 0, 0);
                border: 2px #ad2227 solid;
            }
        </style>
    </head>
    <body>
        <div class="row">
            <div class="hand">
                <card id="d0"></card>
                <card
                    id="d1"
                    style="position: relative; top: 2.5rem; left: -4.5rem"
                ></card>
            </div>

            <div class="dealt">
                <card id="d2" style="display: none"></card>
                <card
                    id="d3"
                    style="position: relative; top: -5.5rem; display: none"
                ></card>
                <card
                    id="d4"
                    style="position: relative; top: -11rem; display: none"
                ></card>
                <card
                    id="d5"
                    style="position: relative; top: -16.5rem; display: none"
                ></card>
            </div>
        </div>

        <div class="row" style="position: fixed; top: 15rem">
            <div class="hand">
                <card id="p0"></card>
                <card
                    id="p1"
                    style="position: relative; top: 2.5rem; left: -4.5rem"
                ></card>
            </div>

            <div class="dealt">
                <card id="p2" style="display: none"></card>
                <card
                    id="p3"
                    style="
                        position: relative;
                        top: -7rem;
                        left: 3rem;
                        display: none;
                    "
                ></card>
                <card
                    id="p4"
                    style="position: relative; top: -13rem; display: none"
                ></card>
                <card
                    id="p5"
                    style="
                        position: relative;
                        top: -19.5rem;
                        left: 3rem;
                        display: none;
                    "
                ></card>
                <card
                    id="p6"
                    style="position: relative; top: -25.5rem; display: none"
                ></card>
                <card
                    id="p7"
                    style="
                        position: relative;
                        top: -32rem;
                        left: 3rem;
                        display: none;
                    "
                ></card>
                <card
                    id="p8"
                    style="position: relative; top: -38rem; display: none"
                ></card>
            </div>
        </div>

        <div
            onclick="reset()"
            id="result"
            style="position: relative; top: 22rem; color: #fafafa"
        ></div>

        <div class="footer">
            <div class="options">
                <button id="hit" onclick="hit(playerHand)">carte!</button>

                <button id="stand" onclick="stand()">je m'y tiens...</button>
            </div>

            <card class="down"></card>
        </div>

        <script>
            var deck = [];

            var playerHand = [];
            var dealerHand = [];

            var turn = "p";

            function draw(d) {
                var i = Math.floor(Math.random() * d.length);
                var c = d[i];
                d.splice(i, 1);
                return c;
            }

            function hit(hand) {
                var card = draw(deck);

                hand.push(card);
                i = hand.length;

                document
                    .getElementById(`${turn}${i - 1}`)
                    .classList.add(hand[i - 1][0]);
                document.getElementById(`${turn}${i - 1}`).innerText =
                    `${hand[i - 1][0]}${hand[i - 1][1]}`;
                document.getElementById(`${turn}${i - 1}`).style.display =
                    "block";

                if (turn == "p" && sumHand(hand) > 21) {
                    stand();
                }
            }

            function stand() {
                turn = "d";

                document.getElementById("hit").disabled = "disabled";
                document.getElementById("stand").disabled = "disabled";
                document.getElementById("d1").classList.remove("down");

                while (!(sumHand(dealerHand) > 16)) {
                    hit(dealerHand);
                }

                var dh = sumHand(dealerHand);
                var ph = sumHand(playerHand);
                var winner = "the house wins";

                if (ph < 22) {
                    if (dh > 21 || ph > dh) {
                        winner = "you win!!";
                    }
                    if (ph == dh) {
                        winner = "it's a draw";
                    }
                } else if (dh > 21) {
                    winner = "both loose";
                }
                document.getElementById("result").innerText = `${winner} ↻`;
            }

            function sumHand(hand) {
                var sum = 0;

                for (card of hand) {
                    switch (card[1]) {
                        case "K":
                        case "Q":
                        case "J":
                            sum += 10;
                            break;
                        case "A":
                            sum += 11;
                            break;
                        default:
                            sum += parseInt(card[1]);
                    }
                }

                return sum;
            }

            function reset() {
                deck = [];
                dealerHand = [];
                playerHand = [];
                turn = "p";

                // ⚘ ⚫︎ ⚔ bell cup leaf
                for (suit of ["♥", "♠", "♦", "♣"]) {
                    for (rank of [
                        "2",
                        "3",
                        "4",
                        "5",
                        "6",
                        "7",
                        "8",
                        "9",
                        "10",
                        "J",
                        "Q",
                        "K",
                        "A",
                    ]) {
                        deck.push([suit, rank]);
                    }
                }

                for (var i = 2; i < 8; i++) {
                    document.getElementById(`p${i}`).style.display = "none";
                    document
                        .getElementById(`p${i}`)
                        .classList.remove("♥", "♠", "♦", "♣");
                }

                for (pos of [0, 1]) {
                    playerHand.push(draw(deck));

                    document
                        .getElementById(`p${pos}`)
                        .classList.remove("♥", "♠", "♦", "♣");
                    document
                        .getElementById(`p${pos}`)
                        .classList.add(playerHand[pos][0]);
                    document.getElementById(`p${pos}`).innerText =
                        `${playerHand[pos][0]}${playerHand[pos][1]}`;
                }

                for (var i = 2; i < 5; i++) {
                    document.getElementById(`d${i}`).style.display = "none";
                    document
                        .getElementById(`d${i}`)
                        .classList.remove("♥", "♠", "♦", "♣");
                }

                for (pos of [0, 1]) {
                    dealerHand.push(draw(deck));

                    document
                        .getElementById(`d${pos}`)
                        .classList.remove("♥", "♠", "♦", "♣");
                    document
                        .getElementById(`d${pos}`)
                        .classList.add(dealerHand[pos][0]);
                    document.getElementById(`d${pos}`).innerText =
                        `${dealerHand[pos][0]}${dealerHand[pos][1]}`;
                }
                document.getElementById("d1").classList.add("down");

                document.getElementById("hit").removeAttribute("disabled");
                document.getElementById("stand").removeAttribute("disabled");

                document.getElementById("result").innerText = "";
            }

            reset();
        </script>
    </body>
</html>
