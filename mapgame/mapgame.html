<!doctype html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html lang="en-GB">
    <head>
        <title>radius map game</title>
        <style>
            :root {
                font-family: system-ui;
            }

            .map-box {
                height: 40rem;
                width: 65rem;
                overflow: scroll;
                background-color: #cef;
            }

            .map {
                width: 1030px;
                height: 1034px;
            }

            .marker {
                position: relative;
                color: #f77;
                width: 0em;
                height: 0em;
                text-align: center;
                line-height: 1rem;
                cursor: crosshair;
            }

            .marker[title]:hover::after {
                content: attr(title);
                position: absolute;
                top: -100%;
                left: 1rem;
                color: #000;
                z-index: 1;
            }
        </style>
    </head>
    <body>
        <div class="map-box">
            <div class="map" id="map"></div>
        </div>

        <input type="range" min="7" max="11" step="0.1" />

        <script src="./cities.js"></script>
        <script>
            const m = document.getElementById("map");
            let scale = 9;

            const input = document.querySelector("input");
            input.addEventListener("input", function (event) {
                scale = event.target.value;
                set();
            });

            function start() {
                for (var x in cities) {
                    const div = document.createElement("div");

                    div.id = x;
                    div.title = cities[x][0];
                    div.className = "marker";
                    div.innerText = "Â·";
                    div.style.top = `${lat2tile(cities[x][1], scale) / 5.12}%`;
                    div.style.left = `${lon2tile(cities[x][2], scale) / 5.12}%`;
                    m.appendChild(div);
                }
            }

            function set() {
                for (var x in cities) {
                    const div = document.getElementById(x);
                    div.style.top = `${lat2tile(cities[x][1], scale) / 5.12}%`;
                    div.style.left = `${lon2tile(cities[x][2], scale) / 5.12}%`;
                }
            }

            function lon2tile(lon, zoom) {
                return Math.floor(((lon + 180) / 360) * Math.pow(2, zoom));
            }

            function lat2tile(lat, zoom) {
                return Math.floor(
                    ((1 -
                        Math.log(
                            Math.tan((lat * Math.PI) / 180) +
                                1 / Math.cos((lat * Math.PI) / 180),
                        ) /
                            Math.PI) /
                        2) *
                        Math.pow(2, zoom),
                );
            }

            start();
        </script>
    </body>
</html>
